---
############################################################
## Main module for Sonatype Nexus Repository Ansible role ##
############################################################

# If action variable is not defined, gather status of the service and set action variable
- name: Gather action variable status...
  ansible.builtin.include_tasks: set_action_type.yml
  when: action_type is not defined

# Show message
- name: Show action message
  ansible.builtin.debug:
    msg: "Starting role {{ role_name }}... action: {{ action_type }}."

# Assert that action is in actions
- name: "Verify valid action ({{ action_type }})..."
  ansible.builtin.assert:
    that:
      - action_type in (actions | map('dict2items') | map('first') | map(attribute='key') | list)
    fail_msg: "The action '{{ action_type }}' is not in the list of valid actions..."
    quiet: true

# Gather vault variables when vault_address and vault_token are defined
- name: Gather vault variables (nexus_repository)...
  ansible.builtin.include_tasks: gather_nexus_repository_variables.yml
  when: vault_address is defined and vault_token is defined

# TODO: Send message to Kafka bus
- name: Publish message to Kafka bus...
  ansible.builtin.debug:
    msg: "TODO: Publish message to Kafka bus..."
  when: kafka_bootstrap_servers is defined

# -------------------------------------------------------
  # install, uninstall, configure, update, setup
- name: Start install action...
  ansible.builtin.include_tasks: install.yml
  when: action_type == "install"

- name: Start uninstall action...
  ansible.builtin.include_tasks: uninstall.yml
  when: action_type == "uninstall"

- name: Start configure action...
  ansible.builtin.include_tasks: configure.yml
  when: action_type == "configure"

- name: Start configure_vault action...
  ansible.builtin.include_tasks: configure_vault.yml
  when: action_type == "configure_vault"

- name: Start update action...
  ansible.builtin.include_tasks: update.yml
  when: action_type == "update"

- name: Start setup action...
  ansible.builtin.include_tasks: setup.yml
  when: action_type == "setup"
# -------------------------------------------------------
 # Start, stop
- name: Start start action...
  ansible.builtin.include_tasks: administration.yml
  when: action_type == "start"

- name: Start stop action...
  ansible.builtin.include_tasks: administration.yml
  when: action_type == "stop"
# -------------------------------------------------------
  # Users
- name: Start get_user action...
  ansible.builtin.include_tasks: users.yml
  when: action_type == "get_user"

- name: Start create_user action...
  ansible.builtin.include_tasks: users.yml
  when: action_type == "create_user"

- name: Start destroy_user action...
  ansible.builtin.include_tasks: users.yml
  when: action_type == "destroy_user"
# -------------------------------------------------------
  # Repositories
- name: Start get_repository action...
  ansible.builtin.include_tasks: repositories/main.yml
  when: action_type == "get_repository"

- name: Start create_repository action...
  ansible.builtin.include_tasks: repositories/main.yml
  when: action_type == "create_repository"

- name: Start destroy_repository action...
  ansible.builtin.include_tasks: repositories/main.yml
  when: action_type == "destroy_repository"
# -------------------------------------------------------
  # Artifacts
- name: Start import_artifacts action...
  ansible.builtin.include_tasks: artifacts/main.yml
  when: action_type == "import_artifacts"

- name: Start export_artifacts action...
  ansible.builtin.include_tasks: artifacts/main.yml
  when: action_type == "export_artifacts"

- name: Start sync_artifacts action...
  ansible.builtin.include_tasks: artifacts/main.yml
  when: action_type == "sync_artifacts"
# -------------------------------------------------------
