---

#########################################################
## Uninstall configuration                             ##
#########################################################

# Create folders from first part of container_volumes
- name: Delete data folders...
  ansible.builtin.file:
    path: "{{ item.split(':')[0] }}"
    state: absent
  with_items: "{{ container_volumes }}"
  when: platform == "podman"
  
#########################################################
## Uninstall via podman                                ##
#########################################################

- name: Uninstall Nexus repository on podman
  when: platform == "podman"
  block:

    # Check if Nexus pod is present
    - name: Check if Nexus Repository container is present
      containers.podman.podman_container_info:
        name: "{{ container_name }}"
      register: nexus_pod_info
      ignore_errors: true

    # Remove Sonatype Nexus pod
    - name: Remove Sonatype Nexus pod
      containers.podman.podman_container:
        name: "{{ container_name }}"
        state: absent
      when: nexus_pod_info is defined
      